@model CRE.ViewModels.ExemptApplicationListViewModel

<h2>Ethics Applications</h2>

<!-- Tabs Navigation -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="exempt-tab" data-toggle="tab" href="#exempt" role="tab" aria-controls="exempt" aria-selected="true">Exempt Applications</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="evaluated-exempt-tab" data-toggle="tab" href="#evaluated-exempt" role="tab" aria-controls="evaluated-exempt" aria-selected="false">Evaluated Exempt Applications</a>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content mt-3" id="myTabContent">
    <!-- Exempt Applications Tab -->
    <div class="tab-pane fade show active" id="exempt" role="tabpanel" aria-labelledby="exempt-tab">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>UREC No</th>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Submission Date</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ExemptApplications == null || !Model.ExemptApplications.Any())
                {
                    <tr>
                        <td colspan="4" class="text-center">No exempt applications found.</td>
                    </tr>
                }
                else
                {
                    foreach (var application in Model.ExemptApplications)
                    {
                        <tr>
                            <td>
                                <a asp-controller="Chief" asp-action="EvaluateApplication" asp-route-urecNo="@application.EthicsApplication?.urecNo" class="btn btn-primary">
                                    @application.EthicsApplication?.urecNo
                                </a>
                            </td>
                            <td>@application.NonFundedResearchInfo?.title</td>
                            <td>
                                @application.EthicsApplicationLog?.FirstOrDefault()?.status
                            </td>
                            <td>
                                @application.EthicsApplication?.submissionDate.ToShortDateString()
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <!-- Evaluated Exempt Applications Tab -->
    <div class="tab-pane fade" id="evaluated-exempt" role="tabpanel" aria-labelledby="evaluated-exempt-tab">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>UREC No</th>
                    <th>Title</th>
                    <th>Evaluation Status</th>
                    <th>Evaluation Protocol Recommendation</th>
                    <th>Evaluation Date</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.EvaluatedExemptApplications == null || !Model.EvaluatedExemptApplications.Any())
                {
                    <tr>
                        <td colspan="6" class="text-center">No evaluated exempt applications found.</td>
                    </tr>
                }
                else
                {
                    foreach (var application in Model.EvaluatedExemptApplications)
                    {
                        <tr>
                            <td>
                                <a asp-controller="Chief"
                                   asp-action="ViewEvaluationDetails"
                                   asp-route-urecNo="@application.EthicsApplication?.urecNo"
                                   asp-route-evaluationId="@application.EthicsEvaluation?.evaluationId"
                                   class="btn btn-info">
                                    @application.EthicsApplication?.urecNo
                                </a>
                            </td>
                            <td>@application.NonFundedResearchInfo?.title</td>
                            <td>Evaluated</td> <!-- Hardcoded "Evaluated" status -->
                            <td>
                                @application.EthicsEvaluation?.ProtocolRecommendation
                            </td>
                            <td>
                                @application.EthicsEvaluation?.endDate
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="evaluationSuccessModal" tabindex="-1" role="dialog" aria-labelledby="evaluationSuccessModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="evaluationSuccessModalLabel">Evaluation Submitted</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Your evaluation was submitted successfully.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Initialize Bootstrap tabs if necessary
            $('#myTab a').on('click', function (e) {
                e.preventDefault();
                $(this).tab('show');
            });

            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            // Check if 'success' parameter exists and is true
            if (urlParams.get('success') === 'true') {
                // Show the success modal
                $('#evaluationSuccessModal').modal('show');
            }
        });
    </script>
}
